///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
INTELLIGENT ACQUISITION - FIND OBJECTS
v1-1

IA_FindObjects_v1-1.bsh
 
Version of intelligent acquisition that scans area defined by the current Position List (explorePositionList), e.g. generated by either "Create Grid" or utilising "HCS Site Generator" plugin

	- go to position in position list
	- exploration acquisition
	- analyse image to find objects
	- if objects are found:	add positions to objectPositionList

	- if nCounts < nObjects, go to next position in explorePositionList
	- when finished, sets objectPositionList to current Position List for subsequent MDA imaging 
 
 * Notes
	- requires a list of positions to search
	- ImageJ macro to analyse exploration images and generate a list of XY coordinates
	- exploration imaging MDA protocol, not include multi-XY positions (that is built-in to script)
	- autofocus recommended if focus position is not defined in explorePositionList
	- a pre-defined offset can be applied to the found positions if different objectives are used for exploration and imaging. Alternatively, this can be done after using the MicroManager Stage Position List window
 	
This script was developed using Micro-Manager v2.0-beta; this version is not compatible with v1.4.

 * Setup

	1. Microscope with motorised XY stage must be controlled by Micro-Manager v2.0-beta
	2. Open IA_FindObjects_v1-1.bsh in the Micro-Manager Script Panel
	3. Define system specific settings:
		- stage direction
		- (optional) assign offset between low resolution and high resolution objectives
	4. Define target number of objects to find
	
 * Before running:
	1. Save Multi-Dimensional Acquisition settings to use for exploration mode 
		Important! Do not include Multiple Positions (XY) in the MDA settings)
		It is recommended to use the autosave option
	2. Generate an ImageJ analysis script to find objects of interest
		Note: The analysis script must output centroid positions of any found objects.
		Remember, Micro-Manager uses an older version of ImageJ so the script must be simple and not rely on plug-ins found in FIJI

 * Start:
	1. Press Run in the Script Panel
	2. You will be prompted to select the exploration settings file
	3. You will be prompted to select the ImageJ analysis script
	

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
AnaFind analysis script

AnaFind.ijm

Find anaphase cells in DAPI image (single slice, 10x objective)

 * 	uses Difference of Gaussian filtering and RenyiEntropy auto thresholding to identify brighter objects (mitotic cells)
 * 	anaphase cells are then selected by their proximity to other found objects (using skeletonize and dilation steps)
  
 * 	outputs list of centroids for use in MicroManager intelligent acqusition
  
 * 	Expects exploration image with 2 channels, but will only analyse channel 1 (DAPI), second/other additional channels to be used for later validation of the script.

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Matthew J. Renshaw
CALM-STP
The Francis Crick Institute
matt.renshaw@crick.ac.uk
